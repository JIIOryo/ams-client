<!DOCTYPE html>
<html lang=“ja”>
  <head>
    <meta charset=“UFT-8”>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,user-scalable=no">
    <title>bandailab</title>
    <link rel="shortcut icon" href="static/favicon.ico">
    <link rel="apple-touch-icon" type="image/png" href="static/icon/apple-touch-icon-180x180.png">
    <link rel="stylesheet" type="text/css" href="static/css/style.css">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
    <script type="text/javascript">
      window.ontouchstart = function() {};
      window.addEventListener('touchstart', function() {}, true);
      window.addEventListener('touchstart', function() {}, false);
    </script>
  </head>
  <body>
    <div id="app">
      <h1> Devices </h1>
      <h1> Sensors </h1>
      <h1> Setting </h1>

      <transition name="fade-translate-display">
        <div class="translate-display" v-show="loading">
          <div class="spinner-box">
            <div class="flower-spinner">
              <div class="dots-container">
                <div class="bigger-dot">
                  <div class="smaller-dot"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </transition>


      <div class="device-container" v-for="device in devices" :key="device.device_id">
        <h2>device_id: {{ device.device_id }}</h2>
        <h2>name: {{ device.name }}</h2>
        <h2>type: {{ device.type }}</h2>
        <label class="switch" @click="updateDeviceState(device.device_id, !device.state)">
          <input type="checkbox" class="switch-input" v-model="device.state" disabled>
          <span class="switch-label" data-on="On" data-off="Off"></span>
          <span class="switch-handle"></span>
        </label>
      </div>
      <br>

    </div>


  <style>
  .device-container {
      margin: auto;
      width: 80%;
      background: #EFFFFF;
      border-radius: 20px;
  }
  </style>


  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios@0.18.0/dist/axios.min.js"></script>


  <script>
  
  const getDeviceState = async () => {
    res = await axios.get('/devices/state')
    return res.data
  };

  const deviceControl = async (deviceId, nextState) => {
    await axios.post('/device/control', {
      devices: [
        {
          device_id: deviceId,
          state: nextState,
        }
      ]
    });
  }

  var app = new Vue({
    el: '#app',
    data: {
      hasError: false,
      loading: false,
      devices: [],
    },
    methods: {
      setDeviceState: async function() {
        this.loading = true
        const deviceState = await getDeviceState()
        this.loading = false

        this.devices = deviceState
      },
      updateDeviceState: async function(deviceId, nextState) {
        if (!this.loading) {
          this.loading = true
          await deviceControl(deviceId, nextState)        
          await this.setDeviceState()
        }
      }
    },
    mounted: async function() {

      this.loading = true
      const deviceState = await getDeviceState()
      this.loading = false

      this.devices = deviceState
    },
  })
  </script>




  <style>
  .switch {
    position: relative;
    display: inline-block;
    vertical-align: top;
    width: 56px;
    height: 20px;
    padding: 3px;
    background-color: white;
    border-radius: 18px;
    box-shadow: inset 0 -1px white, inset 0 1px 1px rgba(0, 0, 0, 0.05);
    cursor: pointer;
    background-image: -webkit-linear-gradient(top, #eeeeee, white 25px);
    background-image: -moz-linear-gradient(top, #eeeeee, white 25px);
    background-image: -o-linear-gradient(top, #eeeeee, white 25px);
    background-image: linear-gradient(to bottom, #eeeeee, white 25px);
  }
  .switch-input {
    position: absolute;
    top: 0;
    left: 0;
    opacity: 0;
  }
  .switch-label {
    position: relative;
    display: block;
    height: inherit;
    font-size: 10px;
    text-transform: uppercase;
    background: #eceeef;
    border-radius: inherit;
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.12), inset 0 0 2px rgba(0, 0, 0, 0.15);
    -webkit-transition: 0.15s ease-out;
    -moz-transition: 0.15s ease-out;
    -o-transition: 0.15s ease-out;
    transition: 0.15s ease-out;
    -webkit-transition-property: opacity background;
    -moz-transition-property: opacity background;
    -o-transition-property: opacity background;
    transition-property: opacity background;
  }
  .switch-label:before, .switch-label:after {
    position: absolute;
    top: 50%;
    margin-top: -.5em;
    line-height: 1;
    -webkit-transition: inherit;
    -moz-transition: inherit;
    -o-transition: inherit;
    transition: inherit;
  }
  .switch-label:before {
    content: attr(data-off);
    right: 11px;
    color: #aaa;
    text-shadow: 0 1px rgba(255, 255, 255, 0.5);
  }
  .switch-label:after {
    content: attr(data-on);
    left: 11px;
    color: white;
    text-shadow: 0 1px rgba(0, 0, 0, 0.2);
    opacity: 0;
  }
  .switch-input:checked ~ .switch-label {
    background: #47a8d8;
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.15), inset 0 0 3px rgba(0, 0, 0, 0.2);
  }
  .switch-input:checked ~ .switch-label:before {
    opacity: 0;
  }
  .switch-input:checked ~ .switch-label:after {
    opacity: 1;
  }
  .switch-handle {
    position: absolute;
    top: 4px;
    left: 4px;
    width: 18px;
    height: 18px;
    background: white;
    border-radius: 10px;
    box-shadow: 1px 1px 5px rgba(0, 0, 0, 0.2);
    background-image: -webkit-linear-gradient(top, white 40%, #f0f0f0);
    background-image: -moz-linear-gradient(top, white 40%, #f0f0f0);
    background-image: -o-linear-gradient(top, white 40%, #f0f0f0);
    background-image: linear-gradient(to bottom, white 40%, #f0f0f0);
    -webkit-transition: left 0.15s ease-out;
    -moz-transition: left 0.15s ease-out;
    -o-transition: left 0.15s ease-out;
    transition: left 0.15s ease-out;
  }
  .switch-handle:before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    margin: -6px 0 0 -6px;
    width: 12px;
    height: 12px;
    background: #f9f9f9;
    border-radius: 6px;
    box-shadow: inset 0 1px rgba(0, 0, 0, 0.02);
    background-image: -webkit-linear-gradient(top, #eeeeee, white);
    background-image: -moz-linear-gradient(top, #eeeeee, white);
    background-image: -o-linear-gradient(top, #eeeeee, white);
    background-image: linear-gradient(to bottom, #eeeeee, white);
  }
  .switch-input:checked ~ .switch-handle {
    left: 40px;
    box-shadow: -1px 1px 5px rgba(0, 0, 0, 0.2);
  }
  .switch-green > .switch-input:checked ~ .switch-label {
    background: #4fb845;
  }
  </style>










  <!-- epic spinners -->
  <style>
  
  .translate-display {
    position: fixed;
    top: 0px;
    left: 0px;
    width: 100%;
    height: 100%;
    z-index: 2;
    /* background: rgba(255, 255, 255, 0.8); */
  }

  .fade-translate-display-leave-active {
  transition: opacity .5s;
  }
  .fade-translate-display-leave-to {
    opacity: 0;
  }

  .spinner-box {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }


  .flower-spinner,  .flower-spinner * {
      box-sizing: border-box;
    }

    .flower-spinner {
      height: 70px;
      width: 70px;
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
    }

    .flower-spinner .dots-container {
      height: calc(70px / 7);
      width: calc(70px / 7);
    }

    .flower-spinner .smaller-dot {
      background: rgb(0, 150, 220);
      height: 100%;
      width: 100%;
      border-radius: 50%;
      animation: flower-spinner-smaller-dot-animation 1.0s 0s infinite both;

    }

    .flower-spinner .bigger-dot {
      background: rgb(0, 150, 220);
      height: 100%;
      width: 100%;
      padding: 10%;
      border-radius: 50%;
      animation: flower-spinner-bigger-dot-animation 1.0s 0s infinite both;
    }

    @keyframes flower-spinner-bigger-dot-animation {
      0%, 100% {
        box-shadow: rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px;
      }

      50% {
        transform: rotate(180deg);
      }

      25%, 75% {
        box-shadow: rgb(0, 150, 220) 26px 0px 0px,
        rgb(0, 150, 220) -26px 0px 0px,
        rgb(0, 150, 220) 0px 26px 0px,
        rgb(0, 150, 220) 0px -26px 0px,
        rgb(0, 150, 220) 19px -19px 0px,
        rgb(0, 150, 220) 19px 19px 0px,
        rgb(0, 150, 220) -19px -19px 0px,
        rgb(0, 150, 220) -19px 19px 0px;
      }

      100% {
        transform: rotate(360deg);
        box-shadow: rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px;
      }
    }

    @keyframes flower-spinner-smaller-dot-animation {
      0%, 100% {
        box-shadow: rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px;
      }

      25%, 75% {
        box-shadow: rgb(0, 150, 220) 14px 0px 0px,
        rgb(0, 150, 220) -14px 0px 0px,
        rgb(0, 150, 220) 0px 14px 0px,
        rgb(0, 150, 220) 0px -14px 0px,
        rgb(0, 150, 220) 10px -10px 0px,
        rgb(0, 150, 220) 10px 10px 0px,
        rgb(0, 150, 220) -10px -10px 0px,
        rgb(0, 150, 220) -10px 10px 0px;
      }

      100% {
        box-shadow: rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px,
        rgb(0, 150, 220) 0px 0px 0px;
      }
    }
  </style>




  </body>
</html>
